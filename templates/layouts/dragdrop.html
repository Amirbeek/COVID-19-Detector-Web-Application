<div class="col-span-4" >
    <div class="w-full p-6 bg-white rounded-lg shadow-lg">
        <h1 class="text-xl font-bold text-gray-800 text-center mb-4">
            Upload Your Images
        </h1>
        <input
            type="file"
            id="file-input"
            class="filepond w-full"
            name="images[]"
            multiple
            data-max-file-size="10MB"
            data-max-files="1"
        />
        <h1 class="text-xl font-bold text-gray-800 text-center mb-4">
            Upload Your Images
        </h1>
    </div>
</div>

{% if prediction %}
    <div class="text-center my-10">
        <h2 class="font-bold text-xl text-gray-800">Prediction Result:</h2>
        <p class="text-gray-500 text-xl">Your image has been analyzed. Check the results below.</p>
        <div>{{ prediction }}</div>
    </div>
{% else %}

    <!-- If no prediction, show the sample image container for users to upload and analyze images -->
    <div class="p-10 bg-[#FADCA2] col-span-7 rounded-lg shadow-lg rounded-t-lg relative" id="sample-images-container">
        <h2 class="font-normal text-gray-800 mb-10 text-4xl">
            Explore X-ray Samples ðŸŒŸ
        </h2>
        <p class="text-gray-600 my-10 text-2xl">
            Try out one of these sample images to get started with your COVID-19 detection.
        </p>
        <div class="swiper">
            <div class="swiper-wrapper">
                <!-- Sample Images -->
                <div class="swiper-slide border-double border-4 rounded-lg text-center">
                    <img src="{{ url_for('static', filename='images/X_Ray_Covid.png') }}"
                         alt="Sample 1" class="h-52 cursor-pointer w-full rounded-lg"
                         onclick="loadSampleImage('{{ url_for('static', filename='images/X_Ray_Covid.png') }}')" />
                    <span>COVID SAMPLE</span>
                </div>
                <div class="swiper-slide border-double border-4 rounded-lg text-center">
                    <img src="{{ url_for('static', filename='images/X_Ray_Normal.png') }}"
                         alt="Sample 2" class="rounded-lg cursor-pointer h-52 w-full"
                         onclick="loadSampleImage('{{ url_for('static', filename='images/X_Ray_Normal.png') }}')" />
                    <span>NORMAL SAMPLE</span>
                </div>
                <div class="swiper-slide border-double border-4 rounded-lg text-center">
                    <img src="{{ url_for('static', filename='images/X_Ray_Virus.png') }}"
                         alt="Sample 3" class="rounded-lg cursor-pointer h-52 w-full"
                         onclick="loadSampleImage('{{ url_for('static', filename='images/X_Ray_Virus.png') }}')" />
                    <span>Virus SAMPLE</span>
                </div>
            </div>
        </div>
        <div class="my-10 grid grid-cols-12">
            <p class="text-gray-500 text-xl col-span-8">Click on an image to preview it here.</p>
            <div class="relative col-span-4">
                <span class="swiper-button-prev p-11 border-solid border-2 cursor-pointer border-slate-400 rounded-full"></span>
                <span class="swiper-button-next py-11 px-11 border-solid border-2 cursor-pointer border-slate-400 rounded-full"></span>
            </div>
        </div>
    </div>
{% endif %}
<script>
    // Initialize Swiper for sample images
    const swiper = new Swiper('.swiper', {
        loop: true,
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
        slidesPerView: 2,
        spaceBetween: 20,
        grabCursor: true,
    });

    function loadSampleImage(url) {
        const fileInput = document.getElementById("file-input");
        const preview = document.getElementById("image-preview");

        FilePond.find(fileInput).removeFiles();
        FilePond.find(fileInput).addFile(url);

        preview.innerHTML = `<img src="${url}" alt="Selected Image" class="w-full h-auto rounded-lg shadow-lg mt-4" />`;
    }

    FilePond.registerPlugin(
        FilePondPluginFileValidateType,
        FilePondPluginImagePreview,
        FilePondPluginFileValidateSize
    );

    const pond = FilePond.create(document.querySelector(".filepond"), {
        server: "/covid",
        process: {
            method: "POST",
            headers: {},
            withCredentials: false,
            timeout: 7000,
            onload: (response) => {
                console.log('Upload Successful:', response);
            },
            onerror: (error) => console.error("Upload error:", error),
        },
        acceptedFileTypes: ["image/*"],
        maxFileSize: "10MB",
        maxFiles: 1,
        instantUpload: true,
    });

    pond.on("removefile", () => {
        const preview = document.getElementById("image-preview");
        preview.innerHTML = '<p class="text-gray-500 text-2xl">Select an image to preview it here.</p>';
    });
</script>
